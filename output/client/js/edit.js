!function(e){var t={};function i(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(n,a,function(t){return e[t]}.bind(null,a));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";i.r(t);const n={},a=function(e,t,i){this.options=$.extend({},n,e),this.pageData=t||{},this.pageItemData=i||{},this.init()};a.prototype={init(){this.duePageAnimatePanelTab(),this.dueTextPanelTab(),this.dueImagePanelTab()},getPageData(){return this.pageData.pageId},setPageData(e,t){this.pageData[e]=t},removePageData(e){delete this.pageData[e]},getItemData(e){return this.pageItemData[e]},setItemData(e,t){this.pageItemData[e]=t},removeItemData(e){delete this.pageItemData[e]},switchToPage(e){const t=this.pageData[e]||{};t.bgColor=t.bgColor||"#FFFFFF",t.bgImage=t.bgImage||"none",$("#bgColor").val(t.bgColor),$("#showBgColor").css("background-color",t.bgColor);const i=t.bgImage;t.bgImage.indexOf("none")<0&&this.setPreview($("#upload-area"),i),$(".attr-wrap").removeClass("active"),$("#bgAttr").addClass("active")},switchToText(e){$(".attr-wrap").removeClass("active"),$("#textAttr").addClass("active");let t=this.pageItemData[e];t||(t={fontSize:"12px",color:"000000",opacity:"100",animate:"selectAnimation",animateDuration:"0.5",animateTimeOut:"1000",width:200,height:30,px:60,py:269}),$("#textFS").val(t.fontSize),$("#textColor").val(t.color),$("#showTextColor").css("background-color",`#${t.color}`),$("#textOpacity").val(t.opacity),$("#textAnimate").val(t.animate),$("#textAniDuration").val(t.animateDuration),$("#textAniTimeOut").val(t.animateTimeOut),$("#textWidth").val(t.width),$("#textHeight").val(t.height),$("#textX").val(t.px),$("#textY").val(t.py)},switchToImg(e){$(".attr-wrap").removeClass("active"),$("#imgAttr").addClass("active");let t=this.pageItemData[e];t||(t={imgUrl:"client/images/default.png",animate:"selectAnimation",animateDuration:"0.5",animateTimeOut:"1000",width:100,height:100,px:110,py:234,opacity:100}),$("#imgAnimation").val(t.animate),$("#imgAniDuration").val(t.animateDuration),$("#imgAniTimeOut").val(t.animateTimeOut),$("#imgWidth").val(t.width),$("#imgHeight").val(t.height),$("#imgX").val(t.px),$("#imgY").val(t.py),$("#imgOpacity").val(t.opacity),this.setPreview($("#image-upload-area"),t.imgUrl)},setPreview(e,t){if(e.children(".imageWrap").remove(),!t||"none"===t)return;const i=new Image;i.src=t,i.height=e.height()-2;const n=$('<div class="imageWrap"> </div>');n.css({position:"absolute","text-align":"center",top:"0",left:"0",width:"100%",height:"100%","z-index":"99"}),n.append(i),e.append(n)},duePageAnimatePanelTab(){$(".page-animate h1").on("click",function(){const e=$(this).data("id");$(this).addClass("sel").siblings("h1").removeClass("sel"),$(`#${e}`).removeClass("hidden").siblings().addClass("hidden")})},dueTextPanelTab(){const e=$(".text-tab"),t=$("#tabHandler h1");t.each(function(i){$(this).on("click",function(){e.addClass("hidden"),e.eq(i).removeClass("hidden"),t.removeClass("sel"),$(this).addClass("sel")})})},dueImagePanelTab(){const e=$(".image-tab"),t=$("#imageTabHandler h1");t.each(function(i){$(this).on("click",function(){e.addClass("hidden"),e.eq(i).removeClass("hidden"),t.removeClass("sel"),$(this).addClass("sel")})})},cleanText:e=>e=(e=(e=(e=(e=(e=e.replace(/<\/?[^>]*>/g,"")).replace(/[ | ]*\n/g,"\n")).replace(/\n[\s| | ]*\r/g,"\n")).replace(/ /gi,"")).replace(/^[\s　]+|[\s　]+$/g,"")).replace(/[\r\n]/g,""),sortPageItems(){const e=this,t={};return Object.keys(this.pageItemData).forEach(i=>{const n=e.pageItemData[i],{pageId:a}=n;t[a]||(t[a]=[]);let o=n.animate;o&&"selectAnimation"!==o||(o="none");const s={px:n.px,py:n.py,width:n.width,height:n.height,transparent:n.opacity,animateClass:o,animateDuration:1e3*parseInt(n.animateDuration,10),nextAnimateTime:n.animateTimeOut,zIndex:99,textStyle:{color:`#${n.color}`,"font-size":n.fontSize,"line-height":`rem(${n.height})`}};if(n.text&&(s.text=e.cleanText(n.text)),n.imgUrl){let e;if(n.imgUrl.indexOf("/")<0||n.imgUrl.indexOf("default")>=0)e="default.png";else{const t=n.imgUrl.split("/");e=t[t.length-1]}s.imgUrl=`images/${e}`}t[a].push(s)}),t},buildData(){const e=this,t=[],i=e.sortPageItems();return $(".page-wrap").each(function(){const n=$(this).attr("id"),a=e.pageData[n],o=a.bgImage.split("/"),s={burl:`../images/${o[o.length-1]}`,bgColor:a.bgColor,items:i[n]||[]};t.push(s)}),{pages:t}}};var o=a;const s={dropArea:"#upload-area",success:!1,error:!1,url:"/upload-file",fileHandler:"#fileHandler"},r=function(e){this.options=$.extend({},s,e),this.init()};r.prototype={init(){this.area=$(this.options.dropArea),this.clearDefault(),this.bindOnDrop(),this.bindFileInput()},clearDefault(){$(document).on({dragleave(e){e.preventDefault()},drop(e){e.preventDefault()},dragenter(e){e.preventDefault()},dragover(e){e.preventDefault()}})},bindOnDrop(){const e=this;e.area[0].addEventListener("drop",t=>{t.preventDefault();const i=t.dataTransfer.files;return 0!==i.length&&(-1===i[0].type.indexOf("image")?(console.log("您拖的不是图片！"),!1):(e.upload(i[0]),!0))})},upload(e){const t=this,i=new FormData;i.append("file",e),$.ajax({url:t.options.url,type:"POST",cache:!1,data:i,processData:!1,contentType:!1}).done(e=>{const i=JSON.parse(e);t.preview(i.data.filePath),t.options.success&&t.options.success(i)}).fail(e=>{t.options.error&&t.options.error(e)})},bindFileInput(){const e=this,t=$(e.options.fileHandler),i=$('<input type="file" class="file-input"></input>');i.css({display:"none"}),t.parent("div").append(i),t.on("click",()=>{t.parent("div").children(".file-input").trigger("click")}),i.on("change",function(){e.upload($(this)[0].files[0])})},preview(e){const{area:t}=this;t.children(".imageWrap").remove();const i=new Image;i.src=e,i.height=t.height()-2;const n=$('<div class="imageWrap"> </div>');n.css({position:"absolute","text-align":"center",top:"0",left:"0",width:"100%",height:"100%","z-index":"99"}),n.append(i),t.append(n)},clear(){this.area.children(".imageWrap").remove()}};var l=r;const c={rTab:!1,pageController:!1},d=function(e){this.options=$.extend({},c,e),this.init()};d.prototype={init(){this.index=0,this.bindAddEvent(),this.dueImageUpload(),this.bindDeleteEvent(),this.bindAnimateEvent(),this.bindSizeEvent()},addImageItem(){const{pageController:e}=this.options;e||console.log("骚年，没传页面控制器我怎么给你增加图片域啊");const t=e.getCurrentPage(),i=$(`#${t.stageId}`);this.index+=1;const n=`<div class="create-img-box" id="${`${t.stageId}-img-item${this.index}_`}">`+'<img src="client/images/default.png" /></div>',a=$(n);i.append(a),t.zResize.addResizeCapa(a),t.zResize.triggerResize(a)},bindAddEvent(){const e=this;$("#addImage").on("click",()=>{e.addImageItem()})},dueImageUpload(){const e=this,t=new l({dropArea:"#image-upload-area",fileHandler:"#imgChange",success(t){$(`#${e.options.pageController.getCurrentPage().stageId}`).children(".resize-item.item-show").children("img").attr("src",t.data.filePath)},error(e){console.log(e)}});$("#imgDelete").on("click",()=>{t.clear(),$(`#${e.options.pageController.getCurrentPage().stageId}`).children(".resize-item.item-show").children("img").removeAttr("src")})},bindDeleteEvent(){const e=this;$("#imageItemDelete").bind("click",()=>{const t=e.options.pageController.getCurrentPage(),i=$(`#${t.stageId}`).children(".resize-item.item-show");i.remove(),e.options.rTab.switchToPage(t.pageId),e.options.rTab.removeItemData(i.attr("id"))})},getCurentItem(){const e=this.options.pageController.getCurrentPage();return $(`#${e.stageId}`).children(".resize-item.item-show")},bindAnimateEvent(){const e=this;$("#imgAnimation").on("change",function(){const t=$(this).val(),i=$("#imgAniDuration").val();e.getCurentItem().css({"-webkit-animation":`${t} ${i}s linear`,animation:`${t} ${i}s linear`})}),$("#imgAniDuration").on("keydown",function(t){const i=e.getCurentItem();if(13===t.keyCode){const e=$("#imgAnimation").val(),t=$(this).val();i.css({"-webkit-animation":"none",animation:"none"}),setTimeout(()=>{i.css({"-webkit-animation":`${e} ${t}s linear`,animation:`${e} ${t}s linear`})},t)}})},bindSizeEvent(){const e=this;$("#imgWidth").on("keydown",function(t){const i=e.getCurentItem();13===t.keyCode&&i.css({width:$(this).val()}).children(".resize-panel").css({width:$(this).val()})}),$("#imgHeight").on("keydown",function(t){const i=e.getCurentItem();13===t.keyCode&&i.css({height:$(this).val()}).children(".resize-panel").css({height:$(this).val()})}),$("#imgX").on("keydown",function(t){const i=e.getCurentItem();13===t.keyCode&&i.css({left:`${$(this).val()}px`})}),$("#imgY").on("keydown",function(t){const i=e.getCurentItem();13===t.keyCode&&i.css({top:`${$(this).val()}px`})}),$("#imgOpacity").on("keydown",function(t){const i=e.getCurentItem();13===t.keyCode&&i.css({opacity:parseInt($(this).val(),10)/100})})}};var g=d;const p={rTab:!1,pageController:!1},h=function(e){this.options=$.extend({},p,e),this.init()};h.prototype={init(){this.index=0,this.bindAddEvent(),this.bindDeleteEvent(),this.bindColorEvent(),this.bindSizeEvent(),this.bindAnimateEvent()},addText(){const{pageController:e}=this.options;e||console.log("骚年，没传页面控制器我怎么给你增加文本啊");const t=e.getCurrentPage(),i=$(`#${t.stageId}`);this.index+=1;const n=`${t.stageId}-text-item${this.index}`,a=$(`<div id="${n}" class="create-text-box" title="编辑文本"  data-type="text" ><p contentEditable="true" class="ol-n">输入文本</p></div>`);i.append(a),t.zResize.addResizeCapa(a),t.zResize.triggerResize(a),a.children("p").focus()},bindAddEvent(){const e=this;$("#addText").on("click",()=>{e.addText()})},bindDeleteEvent(){const e=this;$("#textDelete").bind("click",()=>{const t=e.options.pageController.getCurrentPage(),i=$(`#${t.stageId}`).children(".resize-item.item-show"),n=i.attr("id");i.remove(),e.options.rTab.switchToPage(t.pageId),e.options.rTab.removeItemData(n)})},bindColorEvent(){},getCurentItem(){const e=this.options.pageController.getCurrentPage();return $(`#${e.stageId}`).children(".resize-item.item-show")},bindSizeEvent(){const e=this;$("#textFS").on("input",t=>{const i=e.getCurentItem(),n=parseFloat(t.target.value);n&&n>0&&i.find('p[contenteditable="true"]').css("font-size",`${n}px`)}),$("#textWidth").on("keydown",function(t){const i=e.getCurentItem();13===t.keyCode&&i.css({width:$(this).val()}).children(".resize-panel").css({width:$(this).val()})}),$("#textHeight").on("keydown",function(t){const i=e.getCurentItem();13===t.keyCode&&i.css({height:$(this).val(),"line-height":`${$(this).val()}px`}).children(".resize-panel").css({height:$(this).val()})}),$("#textX").on("keydown",function(t){const i=e.getCurentItem();13===t.keyCode&&i.css({left:`${$(this).val()}px`})}),$("#textY").on("keydown",function(t){const i=e.getCurentItem();13===t.keyCode&&i.css({top:`${$(this).val()}px`})}),$("#textOpacity").on("keydown",function(t){const i=e.getCurentItem();13===t.keyCode&&i.css({opacity:parseInt($(this).val(),10)/100})})},bindAnimateEvent(){const e=this;$("#textAnimate").on("change",function(){const t=$(this).val(),i=$("#textAniDuration").val();e.getCurentItem().css({"-webkit-animation":`${t} ${i}s linear`,animation:`${t} ${i}s linear`})}),$("#textAniDuration").on("keydown",function(t){const i=e.getCurentItem();if(13===t.keyCode){const e=$("#textAnimate").val(),t=$(this).val();i.css({"-webkit-animation":"none",animation:"none"}),setTimeout(()=>{i.css({"-webkit-animation":`${e} ${t}s linear`,animation:`${e} ${t}s linear`})},t)}})}};var u=h;!function(){const e=window.settingData||{};e.pointer=e.pointer||"15.png";const t=function(){this.init()};t.prototype={init(){this.pageController=!1,this.rTab=new o({},window.pageData,window.pageItemData),this.dueDialog(),this.duePage(),this.dueBgUpload(),this.dueText(),this.dueImage(),this.duePreview(),this.dueHeadButton(),this.changeTab(),window.update=this.update,window.updateTextColor=this.updateTextColor},dueBgUpload(){const e=this,t=new l({dropArea:"#upload-area",fileHandler:"#bgChange",success(t){const i=e.pageController.getCurrentPage().stageId;$(`#${i}`).css({"background-image":`url(${t.data.filePath})`})},error(e){console.log(e)}});$("#bgDelete").on("click",()=>{t.clear();const i=e.pageController.getCurrentPage().stageId;$(`#${i}`).css({"background-image":"none"})})},duePage(){this.pageController=new PageController({rTab:this.rTab}),$("#page1").trigger("click")},dueText(){new u({pageController:this.pageController,rTab:this.rTab})},dueImage(){new g({pageController:this.pageController,rTab:this.rTab})},duePreview(){const t=this;$("#preview").on("click",()=>{t.pageController.saveCurrentPage(),t.pageController.saveCurrentItem();const i=t.rTab.buildData();i.pointer=e.pointer,$.post("/build",{config:JSON.stringify(i)},e=>{const t=JSON.parse(e),i=$(".simulator-box").length,n=`show-h5.html?src=${t.data.viewPath}&pages=${i}`;window.open(n,"newwindow")})})},update(e){$(".simulator-box.active").css("background-color",`#${e}`)},updateTextColor(e){$(".resize-item.item-show").css("color",`#${e}`)},save(t){this.pageController.saveCurrentPage(),this.pageController.saveCurrentItem();const i=this.rTab.buildData();i.author=e.author,i.name=e.name,i.discript=e.discript,i.cover=e.cover,i._id=e.id,i.pointer=e.pointer,$.post("/save",{config:JSON.stringify(i)},i=>{const n=JSON.parse(i);"000000"!==n.code?alert(n.msg):(e.id=n.data.id,t?t():alert("保存成功"))})},dueDialog(){const t=this;window.isEdit?($("#author").val(e.author),$("#projectName").val(e.name),$("#projectDiscript").val(e.discript),t.rTab.setPreview($("#uploadCover"),e.cover)):$("#pageInfoDialog").show(),new l({dropArea:"#uploadCover",success(t){e.cover=t.data.filePath},error(e){console.log(e)}}),$("#sure").bind("click",()=>{const t=$("#author").val();if(!t)return void alert("作者必填");const i=$("#projectName").val();if(!i)return void alert("标题必填");const n=$("#projectDiscript").val();console.log(n),e.cover?(e.author=t,e.name=i,e.discript=n,$("#pageInfoDialog").hide()):alert("请上传封面")}),$("#cancel").bind("click",()=>{e.name&&e.author?$("#pageInfoDialog").hide():window.location.href="home"}),$(".icon-handler").each(function(t){$(this).bind("click",()=>{7===t?$(".icon-stage").css({background:"#dbdbdb"}):$(".icon-stage").css({background:"#e6e6e6"}),$("#pointerImg").attr("src",`client/images/pointer/${t+1}.png`),e.pointer=`${t+1}.png`})})},dueHeadButton(){const t=this;$("#save").bind("click",()=>{t.save()}),$("#setting").bind("click",()=>{$("#pageInfoDialog").show()}),$("#download").bind("click",()=>{e.id?t.download():t.save(()=>{t.download()})})},changeTab(){new ChangeTabs},download(){window.location.href=`/download?id=${e.id}`}},new t}()}]);
//# sourceMappingURL=debugging/edit.js.map