!function(e){var t={};function a(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=t,a.d=function(e,t,i){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(i,n,function(t){return e[t]}.bind(null,n));return i},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=2)}([function(e,t){const a={dropArea:"#upload-area",success:!1,error:!1,url:"/upload-file",fileHandler:"#fileHandler"},i=function(e){this.options=$.extend({},a,e),this.init()};i.prototype={init(){this.area=$(this.options.dropArea),this.clearDefault(),this.bindOnDrop(),this.bindFileInput()},clearDefault(){$(document).on({dragleave(e){e.preventDefault()},drop(e){e.preventDefault()},dragenter(e){e.preventDefault()},dragover(e){e.preventDefault()}})},bindOnDrop(){const e=this;e.area[0].addEventListener("drop",t=>{t.preventDefault();const a=t.dataTransfer.files;return 0!==a.length&&(-1===a[0].type.indexOf("image")?(console.log("您拖的不是图片！"),!1):(e.upload(a[0]),!0))})},upload(e){const t=this,a=new FormData;a.append("file",e),$.ajax({url:t.options.url,type:"POST",cache:!1,data:a,processData:!1,contentType:!1}).done(e=>{const a=JSON.parse(e);t.preview(a.data.filePath),t.options.success&&t.options.success(a)}).fail(e=>{t.options.error&&t.options.error(e)})},bindFileInput(){const e=this,t=$(e.options.fileHandler),a=$('<input type="file" class="file-input"></input>');a.css({display:"none"}),t.parent("div").append(a),t.on("click",()=>{t.parent("div").children(".file-input").trigger("click")}),a.on("change",function(){e.upload($(this)[0].files[0])})},preview(e){const{area:t}=this;t.children(".imageWrap").remove();const a=new Image;a.src=e,a.height=t.height()-2;const i=$('<div class="imageWrap"> </div>');i.css({position:"absolute","text-align":"center",top:"0",left:"0",width:"100%",height:"100%","z-index":"99"}),i.append(a),t.append(i)},clear(){this.area.children(".imageWrap").remove()}},e.exports=i},function(e,t){const a={},i=function(e,t,i){this.options=$.extend({},a,e),this.pageData=t||{},this.pageItemData=i||{},this.init()};i.prototype={init(){this.duePageAnimatePanelTab(),this.dueTextPanelTab(),this.dueImagePanelTab()},getPageData(){return this.pageData.pageId},setPageData(e,t){this.pageData[e]=t},removePageData(e){delete this.pageData[e]},getItemData(e){return this.pageItemData[e]},setItemData(e,t){this.pageItemData[e]=t},removeItemData(e){delete this.pageItemData[e]},switchToPage(e){const t=this.pageData[e]||{};t.bgColor=t.bgColor||"#FFFFFF",t.bgImage=t.bgImage||"none",$("#bgColor").val(t.bgColor),$("#showBgColor").css("background-color",t.bgColor);const a=t.bgImage;t.bgImage.indexOf("none")<0&&this.setPreview($("#upload-area"),a),$(".attr-wrap").removeClass("active"),$("#bgAttr").addClass("active")},switchToText(e){$(".attr-wrap").removeClass("active"),$("#textAttr").addClass("active");let t=this.pageItemData[e];t||(t={fontSize:"12px",color:"000000",opacity:"100",animate:"selectAnimation",animateDuration:"0.5",animateTimeOut:"1000",width:200,height:30,px:60,py:269}),$("#textFS").val(t.fontSize),$("#textColor").val(t.color),$("#showTextColor").css("background-color",`#${t.color}`),$("#textOpacity").val(t.opacity),$("#textAnimate").val(t.animate),$("#textAniDuration").val(t.animateDuration),$("#textAniTimeOut").val(t.animateTimeOut),$("#textWidth").val(t.width),$("#textHeight").val(t.height),$("#textX").val(t.px),$("#textY").val(t.py)},switchToImg(e){$(".attr-wrap").removeClass("active"),$("#imgAttr").addClass("active");let t=this.pageItemData[e];t||(t={imgUrl:"client/images/default.png",animate:"selectAnimation",animateDuration:"0.5",animateTimeOut:"1000",width:100,height:100,px:110,py:234,opacity:100}),$("#imgAnimation").val(t.animate),$("#imgAniDuration").val(t.animateDuration),$("#imgAniTimeOut").val(t.animateTimeOut),$("#imgWidth").val(t.width),$("#imgHeight").val(t.height),$("#imgX").val(t.px),$("#imgY").val(t.py),$("#imgOpacity").val(t.opacity),this.setPreview($("#image-upload-area"),t.imgUrl)},setPreview(e,t){if(e.children(".imageWrap").remove(),!t||"none"===t)return;const a=new Image;a.src=t,a.height=e.height()-2;const i=$('<div class="imageWrap"> </div>');i.css({position:"absolute","text-align":"center",top:"0",left:"0",width:"100%",height:"100%","z-index":"99"}),i.append(a),e.append(i)},duePageAnimatePanelTab(){$(".page-animate h1").on("click",function(){const e=$(this).data("id");$(this).addClass("sel").siblings("h1").removeClass("sel"),$(`#${e}`).removeClass("hidden").siblings().addClass("hidden")})},dueTextPanelTab(){const e=$(".text-tab"),t=$("#tabHandler h1");t.each(function(a){$(this).on("click",function(){e.addClass("hidden"),e.eq(a).removeClass("hidden"),t.removeClass("sel"),$(this).addClass("sel")})})},dueImagePanelTab(){const e=$(".image-tab"),t=$("#imageTabHandler h1");t.each(function(a){$(this).on("click",function(){e.addClass("hidden"),e.eq(a).removeClass("hidden"),t.removeClass("sel"),$(this).addClass("sel")})})},cleanText:e=>e=(e=(e=(e=(e=(e=e.replace(/<\/?[^>]*>/g,"")).replace(/[ | ]*\n/g,"\n")).replace(/\n[\s| | ]*\r/g,"\n")).replace(/ /gi,"")).replace(/^[\s　]+|[\s　]+$/g,"")).replace(/[\r\n]/g,""),sortPageItems(){const e=this,t={};return Object.keys(this.pageItemData).forEach(a=>{const i=e.pageItemData[a],{pageId:n}=i;t[n]||(t[n]=[]);let o=i.animate;o&&"selectAnimation"!==o||(o="none");const r={px:i.px,py:i.py,width:i.width,height:i.height,transparent:i.opacity,animateClass:o,animateDuration:1e3*parseInt(i.animateDuration,10),nextAnimateTime:i.animateTimeOut,zIndex:99,textStyle:{color:`#${i.color}`,"font-size":i.fontSize,"line-height":`rem(${i.height})`}};if(i.text&&(r.text=e.cleanText(i.text)),i.imgUrl){let e;if(i.imgUrl.indexOf("/")<0||i.imgUrl.indexOf("default")>=0)e="default.png";else{const t=i.imgUrl.split("/");e=t[t.length-1]}r.imgUrl=`images/${e}`}t[n].push(r)}),t},buildData(){const e=this,t=[],a=e.sortPageItems();return $(".page-wrap").each(function(){const i=$(this).attr("id"),n=e.pageData[i],o=n.bgImage.split("/"),r={burl:`../images/${o[o.length-1]}`,bgColor:n.bgColor,items:a[i]||[]};t.push(r)}),{pages:t}}},e.exports=i},function(e,t,a){"use strict";a.r(t);var i=a(1),n=a.n(i),o=a(0),r=a.n(o);!function(){const e=window.settingData||{};e.pointer=e.pointer||"15.png";const t=function(){this.init()};t.prototype={init(){this.pageController=!1,this.rTab=new n.a({},window.pageData,window.pageItemData),this.dueDialog(),this.duePage(),this.dueBgUpload(),this.dueText(),this.dueImage(),this.duePreview(),this.dueHeadButton(),this.changeTab(),window.update=this.update,window.updateTextColor=this.updateTextColor},dueBgUpload(){const e=this,t=new r.a({dropArea:"#upload-area",fileHandler:"#bgChange",success(t){const a=e.pageController.getCurrentPage().stageId;$(`#${a}`).css({"background-image":`url(${t.data.filePath})`})},error(e){console.log(e)}});$("#bgDelete").on("click",()=>{t.clear();const a=e.pageController.getCurrentPage().stageId;$(`#${a}`).css({"background-image":"none"})})},duePage(){this.pageController=new PageController({rTab:this.rTab}),$("#page1").trigger("click")},dueText(){new TextItem({pageController:this.pageController,rTab:this.rTab})},dueImage(){new ImageItem({pageController:this.pageController,rTab:this.rTab})},duePreview(){const t=this;$("#preview").on("click",()=>{t.pageController.saveCurrentPage(),t.pageController.saveCurrentItem();const a=t.rTab.buildData();a.pointer=e.pointer,$.post("/build",{config:JSON.stringify(a)},e=>{const t=JSON.parse(e),a=$(".simulator-box").length,i=`show-h5.html?src=${t.data.viewPath}&pages=${a}`;window.open(i,"newwindow")})})},update(e){$(".simulator-box.active").css("background-color",`#${e}`)},updateTextColor(e){$(".resize-item.item-show").css("color",`#${e}`)},save(t){this.pageController.saveCurrentPage(),this.pageController.saveCurrentItem();const a=this.rTab.buildData();a.author=e.author,a.name=e.name,a.discript=e.discript,a.cover=e.cover,a._id=e.id,a.pointer=e.pointer,$.post("/save",{config:JSON.stringify(a)},a=>{const i=JSON.parse(a);"000000"!==i.code?alert(i.msg):(e.id=i.data.id,t?t():alert("保存成功"))})},dueDialog(){const t=this;window.isEdit?($("#author").val(e.author),$("#projectName").val(e.name),$("#projectDiscript").val(e.discript),t.rTab.setPreview($("#uploadCover"),e.cover)):$("#pageInfoDialog").show(),new r.a({dropArea:"#uploadCover",success(t){e.cover=t.data.filePath},error(e){console.log(e)}}),$("#sure").bind("click",()=>{const t=$("#author").val();if(!t)return void alert("作者必填");const a=$("#projectName").val();if(!a)return void alert("标题必填");const i=$("#projectDiscript").val();console.log(i),e.cover?(e.author=t,e.name=a,e.discript=i,$("#pageInfoDialog").hide()):alert("请上传封面")}),$("#cancel").bind("click",()=>{e.name&&e.author?$("#pageInfoDialog").hide():window.location.href="home"}),$(".icon-handler").each(function(t){$(this).bind("click",()=>{7===t?$(".icon-stage").css({background:"#dbdbdb"}):$(".icon-stage").css({background:"#e6e6e6"}),$("#pointerImg").attr("src",`client/images/pointer/${t+1}.png`),e.pointer=`${t+1}.png`})})},dueHeadButton(){const t=this;$("#save").bind("click",()=>{t.save()}),$("#setting").bind("click",()=>{$("#pageInfoDialog").show()}),$("#download").bind("click",()=>{e.id?t.download():t.save(()=>{t.download()})})},changeTab(){new ChangeTabs},download(){window.location.href=`/download?id=${e.id}`}},new t}()}]);
//# sourceMappingURL=debugging/edit.js.map