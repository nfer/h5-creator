!function(e){var t={};function i(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=t,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(a,n,function(t){return e[t]}.bind(null,n));return a},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";i.r(t);const a={},n=function(e,t,i){this.options=$.extend({},a,e),this.pageData=t||{},this.pageItemData=i||{},this.init()};n.prototype={init(){this.duePageAnimatePanelTab(),this.dueTextPanelTab(),this.dueImagePanelTab()},getPageData(){return this.pageData.pageId},setPageData(e,t){this.pageData[e]=t},removePageData(e){delete this.pageData[e]},getItemData(e){return this.pageItemData[e]},setItemData(e,t){this.pageItemData[e]=t},removeItemData(e){delete this.pageItemData[e]},switchToPage(e){const t=this.pageData[e]||{};t.bgColor=t.bgColor||"#FFFFFF",t.bgImage=t.bgImage||"none",$("#bgColor").val(t.bgColor),$("#showBgColor").css("background-color",t.bgColor);const i=t.bgImage;t.bgImage.indexOf("none")<0&&this.setPreview($("#upload-area"),i),$(".attr-wrap").removeClass("active"),$("#bgAttr").addClass("active")},switchToText(e){$(".attr-wrap").removeClass("active"),$("#textAttr").addClass("active");let t=this.pageItemData[e];t||(t={fontSize:"12px",color:"000000",opacity:"100",animate:"selectAnimation",animateDuration:"0.5",animateTimeOut:"1000",width:200,height:30,px:60,py:269}),$("#textFS").val(t.fontSize),$("#textColor").val(t.color),$("#showTextColor").css("background-color",`#${t.color}`),$("#textOpacity").val(t.opacity),$("#textAnimate").val(t.animate),$("#textAniDuration").val(t.animateDuration),$("#textAniTimeOut").val(t.animateTimeOut),$("#textWidth").val(t.width),$("#textHeight").val(t.height),$("#textX").val(t.px),$("#textY").val(t.py)},switchToImg(e){$(".attr-wrap").removeClass("active"),$("#imgAttr").addClass("active");let t=this.pageItemData[e];t||(t={imgUrl:"client/images/default.png",animate:"selectAnimation",animateDuration:"0.5",animateTimeOut:"1000",width:100,height:100,px:110,py:234,opacity:100}),$("#imgAnimation").val(t.animate),$("#imgAniDuration").val(t.animateDuration),$("#imgAniTimeOut").val(t.animateTimeOut),$("#imgWidth").val(t.width),$("#imgHeight").val(t.height),$("#imgX").val(t.px),$("#imgY").val(t.py),$("#imgOpacity").val(t.opacity),this.setPreview($("#image-upload-area"),t.imgUrl)},setPreview(e,t){if(e.children(".imageWrap").remove(),!t||"none"===t)return;const i=new Image;i.src=t,i.height=e.height()-2;const a=$('<div class="imageWrap"> </div>');a.css({position:"absolute","text-align":"center",top:"0",left:"0",width:"100%",height:"100%","z-index":"99"}),a.append(i),e.append(a)},duePageAnimatePanelTab(){$(".page-animate h1").on("click",function(){const e=$(this).data("id");$(this).addClass("sel").siblings("h1").removeClass("sel"),$(`#${e}`).removeClass("hidden").siblings().addClass("hidden")})},dueTextPanelTab(){const e=$(".text-tab"),t=$("#tabHandler h1");t.each(function(i){$(this).on("click",function(){e.addClass("hidden"),e.eq(i).removeClass("hidden"),t.removeClass("sel"),$(this).addClass("sel")})})},dueImagePanelTab(){const e=$(".image-tab"),t=$("#imageTabHandler h1");t.each(function(i){$(this).on("click",function(){e.addClass("hidden"),e.eq(i).removeClass("hidden"),t.removeClass("sel"),$(this).addClass("sel")})})},cleanText:e=>e=(e=(e=(e=(e=(e=e.replace(/<\/?[^>]*>/g,"")).replace(/[ | ]*\n/g,"\n")).replace(/\n[\s| | ]*\r/g,"\n")).replace(/ /gi,"")).replace(/^[\s　]+|[\s　]+$/g,"")).replace(/[\r\n]/g,""),sortPageItems(){const e=this,t={};return Object.keys(this.pageItemData).forEach(i=>{const a=e.pageItemData[i],{pageId:n}=a;t[n]||(t[n]=[]);let s=a.animate;s&&"selectAnimation"!==s||(s="none");const o={px:a.px,py:a.py,width:a.width,height:a.height,transparent:a.opacity,animateClass:s,animateDuration:1e3*parseInt(a.animateDuration,10),nextAnimateTime:a.animateTimeOut,zIndex:99,textStyle:{color:`#${a.color}`,"font-size":a.fontSize,"line-height":`rem(${a.height})`}};if(a.text&&(o.text=e.cleanText(a.text)),a.imgUrl){let e;if(a.imgUrl.indexOf("/")<0||a.imgUrl.indexOf("default")>=0)e="default.png";else{const t=a.imgUrl.split("/");e=t[t.length-1]}o.imgUrl=`images/${e}`}t[n].push(o)}),t},buildData(){const e=this,t=[],i=e.sortPageItems();return $(".page-wrap").each(function(){const a=$(this).attr("id"),n=e.pageData[a],s=n.bgImage.split("/"),o={burl:`../images/${s[s.length-1]}`,bgColor:n.bgColor,items:i[a]||[]};t.push(o)}),{pages:t}}};var s=n;const o={dropArea:"#upload-area",success:!1,error:!1,url:"/upload-file",fileHandler:"#fileHandler"},r=function(e){this.options=$.extend({},o,e),this.init()};r.prototype={init(){this.area=$(this.options.dropArea),this.clearDefault(),this.bindOnDrop(),this.bindFileInput()},clearDefault(){$(document).on({dragleave(e){e.preventDefault()},drop(e){e.preventDefault()},dragenter(e){e.preventDefault()},dragover(e){e.preventDefault()}})},bindOnDrop(){const e=this;e.area[0].addEventListener("drop",t=>{t.preventDefault();const i=t.dataTransfer.files;return 0!==i.length&&(-1===i[0].type.indexOf("image")?(console.log("您拖的不是图片！"),!1):(e.upload(i[0]),!0))})},upload(e){const t=this,i=new FormData;i.append("file",e),$.ajax({url:t.options.url,type:"POST",cache:!1,data:i,processData:!1,contentType:!1}).done(e=>{const i=JSON.parse(e);t.preview(i.data.filePath),t.options.success&&t.options.success(i)}).fail(e=>{t.options.error&&t.options.error(e)})},bindFileInput(){const e=this,t=$(e.options.fileHandler),i=$('<input type="file" class="file-input"></input>');i.css({display:"none"}),t.parent("div").append(i),t.on("click",()=>{t.parent("div").children(".file-input").trigger("click")}),i.on("change",function(){e.upload($(this)[0].files[0])})},preview(e){const{area:t}=this;t.children(".imageWrap").remove();const i=new Image;i.src=e,i.height=t.height()-2;const a=$('<div class="imageWrap"> </div>');a.css({position:"absolute","text-align":"center",top:"0",left:"0",width:"100%",height:"100%","z-index":"99"}),a.append(i),t.append(a)},clear(){this.area.children(".imageWrap").remove()}};var l=r;const c={rTab:!1,pageController:!1},d=function(e){this.options=$.extend({},c,e),this.init()};d.prototype={init(){this.index=0,this.bindAddEvent(),this.dueImageUpload(),this.bindDeleteEvent(),this.bindAnimateEvent(),this.bindSizeEvent()},addImageItem(){const{pageController:e}=this.options;e||console.log("骚年，没传页面控制器我怎么给你增加图片域啊");const t=e.getCurrentPage(),i=$(`#${t.stageId}`);this.index+=1;const a=`<div class="create-img-box" id="${`${t.stageId}-img-item${this.index}_`}">`+'<img src="client/images/default.png" /></div>',n=$(a);i.append(n),t.zResize.addResizeCapa(n),t.zResize.triggerResize(n)},bindAddEvent(){const e=this;$("#addImage").on("click",()=>{e.addImageItem()})},dueImageUpload(){const e=this,t=new l({dropArea:"#image-upload-area",fileHandler:"#imgChange",success(t){$(`#${e.options.pageController.getCurrentPage().stageId}`).children(".resize-item.item-show").children("img").attr("src",t.data.filePath)},error(e){console.log(e)}});$("#imgDelete").on("click",()=>{t.clear(),$(`#${e.options.pageController.getCurrentPage().stageId}`).children(".resize-item.item-show").children("img").removeAttr("src")})},bindDeleteEvent(){const e=this;$("#imageItemDelete").bind("click",()=>{const t=e.options.pageController.getCurrentPage(),i=$(`#${t.stageId}`).children(".resize-item.item-show");i.remove(),e.options.rTab.switchToPage(t.pageId),e.options.rTab.removeItemData(i.attr("id"))})},getCurentItem(){const e=this.options.pageController.getCurrentPage();return $(`#${e.stageId}`).children(".resize-item.item-show")},bindAnimateEvent(){const e=this;$("#imgAnimation").on("change",function(){const t=$(this).val(),i=$("#imgAniDuration").val();e.getCurentItem().css({"-webkit-animation":`${t} ${i}s linear`,animation:`${t} ${i}s linear`})}),$("#imgAniDuration").on("keydown",function(t){const i=e.getCurentItem();if(13===t.keyCode){const e=$("#imgAnimation").val(),t=$(this).val();i.css({"-webkit-animation":"none",animation:"none"}),setTimeout(()=>{i.css({"-webkit-animation":`${e} ${t}s linear`,animation:`${e} ${t}s linear`})},t)}})},bindSizeEvent(){const e=this;$("#imgWidth").on("keydown",function(t){const i=e.getCurentItem();13===t.keyCode&&i.css({width:$(this).val()}).children(".resize-panel").css({width:$(this).val()})}),$("#imgHeight").on("keydown",function(t){const i=e.getCurentItem();13===t.keyCode&&i.css({height:$(this).val()}).children(".resize-panel").css({height:$(this).val()})}),$("#imgX").on("keydown",function(t){const i=e.getCurentItem();13===t.keyCode&&i.css({left:`${$(this).val()}px`})}),$("#imgY").on("keydown",function(t){const i=e.getCurentItem();13===t.keyCode&&i.css({top:`${$(this).val()}px`})}),$("#imgOpacity").on("keydown",function(t){const i=e.getCurentItem();13===t.keyCode&&i.css({opacity:parseInt($(this).val(),10)/100})})}};var g=d;const p={rTab:!1,pageController:!1},h=function(e){this.options=$.extend({},p,e),this.init()};h.prototype={init(){this.index=0,this.bindAddEvent(),this.bindDeleteEvent(),this.bindColorEvent(),this.bindSizeEvent(),this.bindAnimateEvent()},addText(){const{pageController:e}=this.options;e||console.log("骚年，没传页面控制器我怎么给你增加文本啊");const t=e.getCurrentPage(),i=$(`#${t.stageId}`);this.index+=1;const a=`${t.stageId}-text-item${this.index}`,n=$(`<div id="${a}" class="create-text-box" title="编辑文本"  data-type="text" ><p contentEditable="true" class="ol-n">输入文本</p></div>`);i.append(n),t.zResize.addResizeCapa(n),t.zResize.triggerResize(n),n.children("p").focus()},bindAddEvent(){const e=this;$("#addText").on("click",()=>{e.addText()})},bindDeleteEvent(){const e=this;$("#textDelete").bind("click",()=>{const t=e.options.pageController.getCurrentPage(),i=$(`#${t.stageId}`).children(".resize-item.item-show"),a=i.attr("id");i.remove(),e.options.rTab.switchToPage(t.pageId),e.options.rTab.removeItemData(a)})},bindColorEvent(){},getCurentItem(){const e=this.options.pageController.getCurrentPage();return $(`#${e.stageId}`).children(".resize-item.item-show")},bindSizeEvent(){const e=this;$("#textFS").on("input",t=>{const i=e.getCurentItem(),a=parseFloat(t.target.value);a&&a>0&&i.find('p[contenteditable="true"]').css("font-size",`${a}px`)}),$("#textWidth").on("keydown",function(t){const i=e.getCurentItem();13===t.keyCode&&i.css({width:$(this).val()}).children(".resize-panel").css({width:$(this).val()})}),$("#textHeight").on("keydown",function(t){const i=e.getCurentItem();13===t.keyCode&&i.css({height:$(this).val(),"line-height":`${$(this).val()}px`}).children(".resize-panel").css({height:$(this).val()})}),$("#textX").on("keydown",function(t){const i=e.getCurentItem();13===t.keyCode&&i.css({left:`${$(this).val()}px`})}),$("#textY").on("keydown",function(t){const i=e.getCurentItem();13===t.keyCode&&i.css({top:`${$(this).val()}px`})}),$("#textOpacity").on("keydown",function(t){const i=e.getCurentItem();13===t.keyCode&&i.css({opacity:parseInt($(this).val(),10)/100})})},bindAnimateEvent(){const e=this;$("#textAnimate").on("change",function(){const t=$(this).val(),i=$("#textAniDuration").val();e.getCurentItem().css({"-webkit-animation":`${t} ${i}s linear`,animation:`${t} ${i}s linear`})}),$("#textAniDuration").on("keydown",function(t){const i=e.getCurentItem();if(13===t.keyCode){const e=$("#textAnimate").val(),t=$(this).val();i.css({"-webkit-animation":"none",animation:"none"}),setTimeout(()=>{i.css({"-webkit-animation":`${e} ${t}s linear`,animation:`${e} ${t}s linear`})},t)}})}};var m=h;const u={},v=function(e){this.options=$.extend({},u,e),this.init()};v.prototype={init(){this.changeTab()},changeTab(){$(".tab1").css({color:"rgb(85,119,221)"}),$(".form-content1").show(),$(".bootstrap-frm h1").bind("click",function(){$(this).css({color:"rgb(85,119,221)"}).siblings().css({color:""}),$(".form-content").eq($(this).index()).show().siblings(".form-content").hide()})}};var w=v;const f={stage:document,itemClass:"resize-item",onTriggerItem:!1,onHideItem:!1,onDrag:!1},b=function(e){this.options=$.extend({},f,e),this.init()};b.prototype={init(){this.initResizeBox()},initResizeBox(){const e=this;$(`.${e.options.itemClass}`).each(function(){e.createResizePanel($(this))}),e.bindHidePanel()},addResizeItem(){const e=$(this.options.stage),t=$(`<div class="${this.options.itemClass}"></div>`);e.append(t),this.createResizePanel(t)},addResizeCapa(e){e.addClass(this.options.itemClass),this.createResizePanel(e)},createResizePanel(e){const t=e.outerWidth(),i=e.outerHeight(),a=$('<div class="resize-panel"></div>');a.css({width:t,height:i,top:0,left:0,position:"absolute","background-color":"rgba(0,0,0,0.1)",cursor:"move",display:"none"}),this.appendHandler(a,e);const n=$('<div class="n"></div>'),s=$('<div class="s"></div>'),o=$('<div class="w"></div>'),r=$('<div class="e"></div>'),l=$('<div class="ne"></div>'),c=$('<div class="nw"></div>'),d=$('<div class="se"></div>'),g=$('<div class="sw"></div>');this.addHandlerCss([n,s,o,r,l,c,d,g]),n.css({top:"-4px","margin-left":"-4px",left:"50%",cursor:"n-resize"}),s.css({bottom:"-4px","margin-left":"-4px",left:"50%",cursor:"s-resize"}),r.css({top:"50%","margin-top":"-4px",right:"-4px",cursor:"e-resize"}),o.css({top:"50%","margin-top":"-4px",left:"-4px",cursor:"w-resize"}),l.css({top:"-4px",right:"-4px",cursor:"ne-resize"}),c.css({top:"-4px",left:"-4px",cursor:"nw-resize"}),d.css({bottom:"-4px",right:"-4px",cursor:"se-resize"}),g.css({bottom:"-4px",left:"-4px",cursor:"sw-resize"}),this.appendHandler([n,s,o,r,l,c,d,g],a),this.bindResizeEvent(a,e),this.bindTrigger(e)},addHandlerCss(e){for(let t=0;t<e.length;t+=1){e[t].css({position:"absolute",width:"8px",height:"8px",background:"#ff6600",margin:"0"})}},appendHandler(e,t){for(let i=0;i<e.length;i+=1){const a=e[i];t.append(a)}},triggerResize(e){const t=this;t.options.onTriggerItem&&t.options.onTriggerItem(e),e.siblings(`.${t.options.itemClass}`).removeClass("item-show").children("div").css({display:"none"}),e.addClass("item-show").children("div").css({display:"block"})},bindResizeEvent(e){const t=this;let i=0,a=0,n=0,s=0,o=0,r=0;const l=e.parent("div");let c=!1;e.on("mousedown",".e",t=>{i=t.pageX,n=e.width(),c=!0});let d=!1;e.on("mousedown",".s",t=>{a=t.pageY,s=e.height(),d=!0});let g=!1;e.on("mousedown",".w",t=>{i=t.pageX,n=e.width(),g=!0,o=parseInt(l.css("left").replace("px",""),10)});let p=!1;e.on("mousedown",".n",t=>{a=t.pageY,s=e.height(),p=!0,r=parseInt(l.css("top").replace("px",""),10)});let h=!1;e.on("mousedown",".ne",t=>{i=t.pageX,a=t.pageY,n=e.width(),s=e.height(),h=!0,r=parseInt(l.css("top").replace("px",""),10)});let m=!1;e.on("mousedown",".nw",t=>{i=t.pageX,a=t.pageY,n=e.width(),s=e.height(),r=parseInt(l.css("top").replace("px",""),10),o=parseInt(l.css("left").replace("px",""),10),m=!0});let u=!1;e.on("mousedown",".se",t=>{i=t.pageX,a=t.pageY,n=e.width(),s=e.height(),u=!0});let v=!1;e.on("mousedown",".sw",t=>{i=t.pageX,a=t.pageY,n=e.width(),s=e.height(),v=!0,o=parseInt(l.css("left").replace("px",""),10)});let w=!1;e.on("mousedown",e=>{i=e.pageX,a=e.pageY,r=parseInt(l.css("top").replace("px",""),10),o=parseInt(l.css("left").replace("px",""),10),w=!0}),$(t.options.stage).on("mousemove",$=>{if(c){const a=$.pageX-i;e.css({width:n+a}),l.css({width:n+a}),t.options.onDrag&&t.options.onDrag(l,{width:n+a})}else if(d){const i=$.pageY-a;e.css({height:s+i}),l.css({height:s+i,"line-height":`${s+i}px`}),t.options.onDrag&&t.options.onDrag(l,{height:s+i})}else if(g){const a=$.pageX-i;e.css({width:n-a}),l.css({width:n-a,left:o+a}),t.options.onDrag&&t.options.onDrag(l,{width:n-a,left:o+a})}else if(p){const i=$.pageY-a;e.css({height:s-i}),l.css({height:s-i,top:r+i,"line-height":`${s-i}px`}),t.options.onDrag&&t.options.onDrag(l,{height:s-i,top:r+i})}else if(h){const o=$.pageX-i,c=$.pageY-a;e.css({height:s-c,width:n+o}),l.css({height:s-c,"line-height":`${s-c}px`,top:r+c,width:n+o}),t.options.onDrag&&t.options.onDrag(l,{height:s-c,top:r+c,width:n+o})}else if(m){const c=$.pageX-i,d=$.pageY-a;e.css({height:s-d,width:n-c}),l.css({height:s-d,"line-height":`${s-d}px`,top:r+d,width:n-c,left:o+c}),t.options.onDrag&&t.options.onDrag(l,{height:s-d,top:r+d,width:n-c,left:o+c})}else if(u){const o=$.pageX-i,r=$.pageY-a;e.css({width:n+o,height:s+r}),l.css({width:n+o,height:s+r,"line-height":`${s+r}px`}),t.options.onDrag&&t.options.onDrag(l,{width:n+o,height:s+r})}else if(v){const r=$.pageX-i,c=$.pageY-a;e.css({width:n-r,height:s+c}),l.css({width:n-r,left:o+r,height:s+c,"line-height":`${s+c}px`}),t.options.onDrag&&t.options.onDrag(l,{width:n-r,left:o+r,height:s+c})}else if(w){const e=$.pageX-i,n=$.pageY-a;l.css({left:o+e,top:r+n}),t.options.onDrag&&t.options.onDrag(l,{left:o+e,top:r+n})}}).on("mouseup",()=>{c=!1,d=!1,g=!1,p=!1,h=!1,m=!1,v=!1,u=!1,w=!1})},bindTrigger(e){const t=this;e.on("click",i=>{i.stopPropagation(),t.triggerResize(e)})},bindHidePanel(){const{stage:e,itemClass:t,onHideItem:i}=this.options;$(e).on("click",()=>{i&&i(),$(`.${t}`).removeClass("item-show").children("div").css({display:"none"})})}};var x=b;const I=function(e){let t,i,a,n;const s=e.replace(/\s+/g,"").match(/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/),o=e.replace(/\s+/g,"").match(/rgba\((\d{1,3}),(\d{1,3}),(\d{1,3}),([.\d]+)\)/);return s?{hex:`#${t=1===(t=(+s[1]).toString(16)).length?`0${t}`:t}${i=1===(i=(+s[2]).toString(16)).length?`0${i}`:i}${a=1===(a=(+s[3]).toString(16)).length?`0${a}`:a}`,alpha:100}:o?(t=1===(t=(+o[1]).toString(16)).length?`0${t}`:t,i=1===(i=(+o[2]).toString(16)).length?`0${i}`:i,a=1===(a=(+o[3]).toString(16)).length?`0${a}`:a,n=100*+o[4],{hex:`#${t}${i}${a}`,alpha:Math.ceil(n)}):{hex:e,alpha:100}},C={rTab:!1},D=function(e){this.options=$.extend({},C,e),this.init()};D.prototype={init(){this.pageIndex=1,this.currentPageId="page1";const e=this;this.zresize=new x({stage:"#mainContent",onTriggerItem(t){e.onItemTrigger(t)},onHideItem(){e.onHideItem()},onDrag(t,i){e.onDrag(t,i)}}),window.pageItemData&&Object.keys(window.pageItemData).forEach(t=>e.zresize.addResizeCapa($(`#${t}`))),this.bindAddEvent(),this.bindRemoveEvent(),this.bindSwitchEvent()},createPage(){this.pageIndex+=1;const e=`page${this.pageIndex}`,t=`<section class="page-wrap" id="${e}">`+'<div class="page"></div><ul class="page-handle"><li class="add" title="新增"></li>'+`<li class="copy" title="复制" data-page="${e}"></li>`+`<li class="delete" title="删除" data-page="${e}"></li>`+"</ul></section>",i=$(t);$("#pageContainer").append(i),this.createStage(e),this.switchPage(e)},onHideItem(){const e=this,{rTab:t}=e.options,i=$(`#${e.currentPageId}-stage`).children(".resize-item.item-show");if(i.length>0){"text"===i.attr("data-type")?e.saveTextItem(i):e.saveImageItem(i)}e.saveCurrentPage(),t.switchToPage(e.currentPageId)},onItemTrigger(e){const t=this,{rTab:i}=t.options,a=$(`#${t.currentPageId}-stage`).children(".resize-item.item-show");if(a.length>0){"text"===a.attr("data-type")?t.saveTextItem(a):t.saveImageItem(a)}"text"===e.attr("data-type")?i.switchToText(e.attr("id")):i.switchToImg(e.attr("id"))},onDrag(e,t){let i=!1,a=!1,n=!1,s=!1;"text"===e.attr("data-type")?(i=$("#textWidth"),a=$("#textHeight"),n=$("#textX"),s=$("#textY")):(i=$("#imgWidth"),a=$("#imgHeight"),n=$("#imgX"),s=$("#imgY")),t.width&&i.val(t.width),t.height&&a.val(t.height),t.left&&n.val(t.left),t.top&&s.val(t.top)},saveImageItem(e){const t=$("#imgAnimation").val(),i=$("#imgAniDuration").val(),a=$("#imgAniTimeOut").val(),n=e.children("img").attr("src"),s=e.attr("id"),o=$("#imgWidth").val(),r=$("#imgHeight").val(),l=$("#imgX").val(),c=$("#imgY").val(),d=$("#imgOpacity").val();this.options.rTab.setItemData(s,{itemId:s,pageId:this.currentPageId,type:"img",animate:t,imgUrl:n,animateDuration:i,animateTimeOut:a,width:o,height:r,px:l,py:c,opacity:d})},saveTextItem(e){const t=$("#textFS").val(),i=I($("#textColor").val()).hex,a=$("#textOpacity").val(),n=$("#textAnimate").val(),s=$("#textAniDuration").val(),o=$("#textAniTimeOut").val(),r=e.attr("id"),l=$("#textWidth").val(),c=$("#textHeight").val(),d=$("#textX").val(),g=$("#textY").val(),p=e.children("p").html();this.options.rTab.setItemData(r,{itemId:r,pageId:this.currentPageId,type:"text",animate:n,animateDuration:s,animateTimeOut:o,fontSize:t,color:i,opacity:a,width:l,height:c,px:d,py:g,text:p})},createStage(e){const t=$('<div class="simulator-box"></div>');t.attr("id",`${e}-stage`),$("#mainContent").append(t)},saveCurrentPage(){const e=$(`#${this.currentPageId}-stage`),{rTab:t}=this.options;let i=e.css("background-image");i=(i=i.replace(/url(\d*)\((.*?)\)/g,(e,t,i)=>i)).replace(/"/g,""),t.setPageData(this.currentPageId,{pageId:this.currentPageId,stageId:`${this.currentPageId}-stage`,bgColor:I(e.css("background-color")).hex,bgImage:i})},saveCurrentItem(){const e=this,t=$(`#${e.currentPageId}-stage`).children(".resize-item.item-show");t.length<=0||("text"===t.attr("data-type")?e.saveTextItem(t):e.saveImageItem(t))},switchPage(e){$(".page-wrap").removeClass("page-sel"),$(`#${e}`).addClass("page-sel");const t=$(`#${e}-stage`),i=$(`#${this.currentPageId}-stage`),{rTab:a}=this.options;this.saveCurrentPage(),i.removeClass("active"),t.addClass("active"),i.trigger("click"),a.switchToPage(e),this.currentPageId=e},getCurrentPage(){return{pageId:this.currentPageId,stageId:`${this.currentPageId}-stage`,zResize:this.zresize}},bindAddEvent(){const e=this;$("#pageContainer").on("click",".add",t=>{t.stopPropagation(),e.createPage()})},bindRemoveEvent(){const e=this;$("#pageContainer").on("click",".delete",function(t){t.stopPropagation();const i=$(this).attr("data-page"),a=$(`#${i}`),n=a.next().length>0&&a.next()||a.prev().length>0&&a.prev();if(!n)return void console.log("就剩一页了，不能再删了，骚年！！");if(!window.confirm("该页面的所有元素也会被删除，确定删除？"))return;i===e.currentPageId&&e.switchPage(n.attr("id")),a.remove(),e.options.rTab.removePageData(i);const s=`${i}-stage`;$(`#${s}`).remove()})},bindSwitchEvent(){const e=this;$("#pageContainer").on("click",".page-wrap",function(){const t=$(this).attr("id");e.switchPage(t)})}};var y=D;!function(){const e=window.settingData||{};e.pointer=e.pointer||"15.png";const t=function(){this.init()};t.prototype={init(){this.pageController=!1,this.rTab=new s({},window.pageData,window.pageItemData),this.dueDialog(),this.duePage(),this.dueBgUpload(),this.dueText(),this.dueImage(),this.duePreview(),this.dueHeadButton(),this.changeTab(),window.update=this.update,window.updateTextColor=this.updateTextColor},dueBgUpload(){const e=this,t=new l({dropArea:"#upload-area",fileHandler:"#bgChange",success(t){const i=e.pageController.getCurrentPage().stageId;$(`#${i}`).css({"background-image":`url(${t.data.filePath})`})},error(e){console.log(e)}});$("#bgDelete").on("click",()=>{t.clear();const i=e.pageController.getCurrentPage().stageId;$(`#${i}`).css({"background-image":"none"})})},duePage(){this.pageController=new y({rTab:this.rTab}),$("#page1").trigger("click")},dueText(){new m({pageController:this.pageController,rTab:this.rTab})},dueImage(){new g({pageController:this.pageController,rTab:this.rTab})},duePreview(){const t=this;$("#preview").on("click",()=>{t.pageController.saveCurrentPage(),t.pageController.saveCurrentItem();const i=t.rTab.buildData();i.pointer=e.pointer,$.post("/build",{config:JSON.stringify(i)},e=>{const t=JSON.parse(e),i=$(".simulator-box").length,a=`show-h5.html?src=${t.data.viewPath}&pages=${i}`;window.open(a,"newwindow")})})},update(e){$(".simulator-box.active").css("background-color",`#${e}`)},updateTextColor(e){$(".resize-item.item-show").css("color",`#${e}`)},save(t){this.pageController.saveCurrentPage(),this.pageController.saveCurrentItem();const i=this.rTab.buildData();i.author=e.author,i.name=e.name,i.discript=e.discript,i.cover=e.cover,i._id=e.id,i.pointer=e.pointer,$.post("/save",{config:JSON.stringify(i)},i=>{const a=JSON.parse(i);"000000"!==a.code?alert(a.msg):(e.id=a.data.id,t?t():alert("保存成功"))})},dueDialog(){const t=this;window.isEdit?($("#author").val(e.author),$("#projectName").val(e.name),$("#projectDiscript").val(e.discript),t.rTab.setPreview($("#uploadCover"),e.cover)):$("#pageInfoDialog").show(),new l({dropArea:"#uploadCover",success(t){e.cover=t.data.filePath},error(e){console.log(e)}}),$("#sure").bind("click",()=>{const t=$("#author").val();if(!t)return void alert("作者必填");const i=$("#projectName").val();if(!i)return void alert("标题必填");const a=$("#projectDiscript").val();console.log(a),e.cover?(e.author=t,e.name=i,e.discript=a,$("#pageInfoDialog").hide()):alert("请上传封面")}),$("#cancel").bind("click",()=>{e.name&&e.author?$("#pageInfoDialog").hide():window.location.href="home"}),$(".icon-handler").each(function(t){$(this).bind("click",()=>{7===t?$(".icon-stage").css({background:"#dbdbdb"}):$(".icon-stage").css({background:"#e6e6e6"}),$("#pointerImg").attr("src",`client/images/pointer/${t+1}.png`),e.pointer=`${t+1}.png`})})},dueHeadButton(){const t=this;$("#save").bind("click",()=>{t.save()}),$("#setting").bind("click",()=>{$("#pageInfoDialog").show()}),$("#download").bind("click",()=>{e.id?t.download():t.save(()=>{t.download()})})},changeTab(){new w},download(){window.location.href=`/download?id=${e.id}`}},new t}()}]);
//# sourceMappingURL=debugging/edit.js.map